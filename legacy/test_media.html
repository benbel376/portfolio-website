<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Files Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
        }
        
        .test-image {
            max-width: 200px;
            max-height: 200px;
            border: 1px solid #ddd;
            margin: 10px;
        }
        
        .error {
            color: red;
        }
        
        .success {
            color: green;
        }
    </style>
</head>

<body>
    <h1>Media Files Accessibility Test</h1>

    <div class="test-section">
        <h2>Testing Image Access</h2>
        <p>Testing if images are accessible from different ports:</p>

        <h3>From Port 80 (Current Origin):</h3>
        <img id="img80" class="test-image" src="/assets/images/general/general_background_bubbles_dark_v1.jpg" alt="Test Image Port 80" onerror="handleImageError(this, '80')" onload="handleImageSuccess(this, '80')">
        <div id="result80" class="result"></div>

        <h3>From Port 8000 (PHP Server):</h3>
        <img id="img8000" class="test-image" src="http://localhost:8000/assets/images/general/general_background_bubbles_dark_v1.jpg" alt="Test Image Port 8000" onerror="handleImageError(this, '8000')" onload="handleImageSuccess(this, '8000')">
        <div id="result8000" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Media Manager URL Test</h2>
        <button onclick="testMediaManagerUrls()">Test Media Manager URLs</button>
        <div id="mediaResults"></div>
    </div>

    <script>
        function handleImageError(img, port) {
            const resultDiv = document.getElementById(`result${port}`);
            resultDiv.innerHTML = `<span class="error">❌ Failed to load image from port ${port}</span>`;
            console.log(`Image failed to load from port ${port}:`, img.src);
        }

        function handleImageSuccess(img, port) {
            const resultDiv = document.getElementById(`result${port}`);
            resultDiv.innerHTML = `<span class="success">✅ Successfully loaded image from port ${port}</span>`;
            console.log(`Image successfully loaded from port ${port}:`, img.src);
        }

        function getMediaFileUrl(filePath) {
            const apiPort = '8000';
            return `${window.location.protocol}//${window.location.hostname}:${apiPort}/assets/images/${filePath}`;
        }

        async function testMediaManagerUrls() {
            const resultsDiv = document.getElementById('mediaResults');
            resultsDiv.innerHTML = '<h3>Testing Media Manager URL Construction...</h3>';

            // Test the utility function
            const testPath = 'general/general_background_bubbles_dark_v1.jpg';
            const constructedUrl = getMediaFileUrl(testPath);

            resultsDiv.innerHTML += `<p><strong>Test file path:</strong> ${testPath}</p>`;
            resultsDiv.innerHTML += `<p><strong>Constructed URL:</strong> ${constructedUrl}</p>`;

            // Test if the URL is accessible
            try {
                const response = await fetch(constructedUrl, {
                    method: 'HEAD'
                });
                if (response.ok) {
                    resultsDiv.innerHTML += `<p class="success">✅ Media file is accessible via constructed URL</p>`;
                } else {
                    resultsDiv.innerHTML += `<p class="error">❌ Media file returned status: ${response.status}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<p class="error">❌ Error accessing media file: ${error.message}</p>`;
            }
        }

        // Test on page load
        window.addEventListener('load', () => {
            console.log('Window location:', window.location.href);
            console.log('Protocol:', window.location.protocol);
            console.log('Hostname:', window.location.hostname);
            console.log('Port:', window.location.port);
        });
    </script>
</body>

</html>